<?xml version="1.0" encoding="utf-8"?>
<modification>
    <name>Casual Watches must-use modifications</name>
    <version>1.0.0</version>
    <code>cw-mu</code>

    <!--
    Replaces default menu
    -->
    <file path="catalog/controller/common/header.php">
        <operation>
            <search index="0">
            <![CDATA[
$data['menu'] = $this->load->controller('common/menu');
            ]]>
            </search>
            <add position="replace"><![CDATA[
$data['menu'] = $this->load->controller('extension/module/main_menu');
            ]]>
            </add>
        </operation>
    </file>


    <!--
    Replaces standard Swiper with Slick
    Removes Magnific Popup, Moment, Bootstrap DateTimePicker
    -->
    <file path="catalog/controller/product/product.php">
        <operation>
            <search index="0">
                <![CDATA[
$this->document->addScript('catalog/view/javascript/jquery/magnific/jquery.magnific-popup.min.js');
                ]]>
            </search>
            <add position="replace" offset="6">
                <![CDATA[
$this->document->addScript('catalog/view/theme/cw/vendors/slick/slick.min.js');
                ]]>
            </add>
        </operation>
    </file>
    <file path="catalog/controller/extension/module/slideshow.php">
        <operation>
            <search index="0">
                <![CDATA[
$this->document->addStyle('catalog/view/javascript/jquery/swiper/css/swiper.min.css');
                ]]>
            </search>
            <add position="replace" offset="2">
                <![CDATA[
$this->document->addScript('catalog/view/theme/cw/vendors/slick/slick.min.js');
                ]]>
            </add>
        </operation>
    </file>
    <file path="catalog/controller/extension/module/carousel.php">
        <operation>
            <search index="0">
                <![CDATA[
$this->document->addStyle('catalog/view/javascript/jquery/swiper/css/swiper.min.css');
                ]]>
            </search>
            <add position="replace" offset="2"><![CDATA[
$this->document->addScript('catalog/view/theme/cw/vendors/slick/slick.min.js');
                ]]>
            </add>
        </operation>
    </file>
    <file path="catalog/controller/extension/module/banner.php">
        <operation>
            <search index="0">
                <![CDATA[
$this->document->addStyle('catalog/view/javascript/jquery/swiper/css/swiper.min.css');
                ]]>
            </search>
            <add position="replace" offset="2"><![CDATA[
$this->document->addScript('catalog/view/theme/cw/vendors/slick/slick.min.js');
                ]]>
            </add>
        </operation>
    </file>


    <!--
    Additional language file
    -->
    <file path="catalog/controller/startup/startup.php">
        <operation>
            <search index="0">
            <![CDATA[
$language->load($code);
            ]]>
            </search>
            <add position="after"><![CDATA[
$language->load('extension/theme/casual_watches');
            ]]>
            </add>
        </operation>
    </file>


    <!--
    Remove sort orders
    -->
    <file path="catalog/controller/product/category.php">
        <operation>
            <search index="0">
            <![CDATA[
'href'  => $this->url->link('product/category', 'path=' . $this->request->get['path'] . '&sort=p.price&order=DESC' . $url)
            ]]>
            </search>
            <add position="replace" offset="26"><![CDATA[
'href'  => $this->url->link('product/category', 'path=' . $this->request->get['path'] . '&sort=p.price&order=DESC' . $url)
            ]]>
            </add>
        </operation>
    </file>


    <!--
    Rename sort orders
    -->
    <file path="catalog/language/ru-ru/product/category.php">
        <operation>
            <search index="0">
            <![CDATA[
$_['text_name_asc']     = 'Название (А - Я)';
            ]]>
            </search>
            <add position="replace" offset="3"><![CDATA[
$_['text_name_asc']     = 'А &rarr; Я';
$_['text_name_desc']    = 'Я &rarr; А';
$_['text_price_asc']    = 'Сначала дешевые';
$_['text_price_desc']   = 'Сначала дорогие';
            ]]>
            </add>
        </operation>
    </file>


    <!--
    Discount in product teaser
    -->
    <file path="catalog/controller/product/category.php">
        <operation>
            <search>
                <![CDATA[
$special = false;
                ]]>
            </search>
            <add position="after" offset="1">
                <![CDATA[
if ((float)$result['special']) {
    $discount = '-' . round(100 - $this->tax->calculate($result['special'], $result['tax_class_id'], $this->config->get('config_tax')) / $this->tax->calculate($result['price'], $result['tax_class_id'], $this->config->get('config_tax')) * 100) . '%';
} else {
    $discount = false;
}
                ]]>
            </add>
        </operation>

        <operation>
            <search>
                <![CDATA[
'special'     => $special,
                ]]>
            </search>
            <add position="after" offset="1">
                <![CDATA[
'discount'     => $discount,
                ]]>
            </add>
        </operation>
    </file>

    <!--
    Adds variables with the number of products in the cart
    -->
    <file path="catalog/controller/common/cart.php">
        <operation>
            <search index="0">
                <![CDATA[
$data['text_items'] = sprintf($this->language->get('text_items'), $this->cart->countProducts() + (isset($this->session->data['vouchers']) ? count($this->session->data['vouchers']) : 0), $this->currency->format($total, $this->session->data['currency']));
                ]]>
            </search>
            <add position="after">
                <![CDATA[
$data['count_products'] = $this->cart->countProducts();
                ]]>
            </add>
        </operation>
    </file>


    <!--
    Adds variables with the number of products in the wishlist
    -->
    <file path="catalog/controller/common/header.php">
        <operation>
            <search index="0">
                <![CDATA[
$data['text_wishlist'] = sprintf($this->language->get('text_wishlist'), $this->model_account_wishlist->getTotalWishlist());
                ]]>
            </search>
            <add position="after">
                <![CDATA[
$data['count_wishlist'] = $this->model_account_wishlist->getTotalWishlist();
                ]]>
            </add>
        </operation>
        <operation>
            <search index="0">
                <![CDATA[
$data['text_wishlist'] = sprintf($this->language->get('text_wishlist'), (isset($this->session->data['wishlist']) ? count($this->session->data['wishlist']) : 0));
                ]]>
            </search>
            <add position="after">
                <![CDATA[
$data['count_wishlist'] = isset($this->session->data['wishlist']) ? count($this->session->data['wishlist']) : 0;
                ]]>
            </add>
        </operation>
    </file>


    <!--
    Remove text from account/wishlist/add response
    -->
    <file path="catalog/controller/account/wishlist.php">
        <operation>
            <search index="0">
            <![CDATA[
$json['total'] = sprintf($this->language->get('text_wishlist'), $this->model_account_wishlist->getTotalWishlist());
            ]]>
            </search>
            <add position="replace"><![CDATA[
$json['total'] = $this->model_account_wishlist->getTotalWishlist();
            ]]>
            </add>
        </operation>
        <operation>
            <search index="0">
                <![CDATA[
$json['total'] = sprintf($this->language->get('text_wishlist'), (isset($this->session->data['wishlist']) ? count($this->session->data['wishlist']) : 0));
                ]]>
            </search>
            <add position="replace">
                <![CDATA[
$json['total'] = (isset($this->session->data['wishlist']) ? count($this->session->data['wishlist']) : 0);
                ]]>
            </add>
        </operation>
    </file>


    <!--
    Second phone number
    -->
    <file path="admin/view/template/setting/setting.twig">
        <operation>
            <search index="0">
            <![CDATA[
<label class="col-sm-2 control-label" for="input-telephone">{{ entry_telephone }}</label>
            ]]>
            </search>
            <add position="after" offset="6"><![CDATA[
<div class="form-group">
    <label class="col-sm-2 control-label" for="input-telephone2">{{ entry_telephone }}</label>
    <div class="col-sm-10">
        <input type="text" name="config_telephone2" value="{{ config_telephone2 }}" placeholder="{{ entry_telephone }}" id="input-telephone2" class="form-control">
    </div>
</div>
            ]]>
            </add>
        </operation>
    </file>
    <file path="admin/controller/setting/setting.php">
        <operation>
            <search index="0">
            <![CDATA[
if (isset($this->request->post['config_telephone'])) {
            ]]>
            </search>
            <add position="after" offset="4"><![CDATA[
if (isset($this->request->post['config_telephone2'])) {
    $data['config_telephone2'] = $this->request->post['config_telephone2'];
} else {
    $data['config_telephone2'] = $this->config->get('config_telephone2');
}
            ]]>
            </add>
        </operation>
    </file>
    <file path="catalog/controller/common/header.php">
        <operation>
            <search index="0">
            <![CDATA[
$data['telephone'] = $this->config->get('config_telephone');
            ]]>
            </search>
            <add position="after" offset="4"><![CDATA[
$data['telephone2'] = $this->config->get('config_telephone2');
            ]]>
            </add>
        </operation>
    </file>


    <!--
    Opening time in header
    -->
    <file path="catalog/controller/common/header.php">
        <operation>
            <search index="0">
            <![CDATA[
$data['telephone'] = $this->config->get('config_telephone');
            ]]>
            </search>
            <add position="after"><![CDATA[
$data['open'] = $this->config->get('config_open');
            ]]>
            </add>
        </operation>
    </file>


    <!--
    Brand logo in product page
    -->
    <file path="catalog/controller/product/product.php">
        <operation>
            <search><![CDATA[
$this->load->model('tool/image');
            ]]>
            </search>
            <add position="after">
                <![CDATA[
$manufacturer_image = $this->model_catalog_manufacturer->getManufacturer($product_info['manufacturer_id']);

if ($manufacturer_image) {
    $data['manufacturers_logo'] = $this->model_tool_image->resize($manufacturer_image['image'], 64, 64);
} else {
    $data['manufacturers_logo'] = false;
}
                ]]>
            </add>
        </operation>
    </file>


    <!--
    Product
    - Adds SKU
    -->
    <file path="catalog/controller/product/product.php">
        <operation>
            <search index="0">
            <![CDATA[
$data['model'] = $product_info['model'];
            ]]>
            </search>
            <add position="after"><![CDATA[
$data['sku'] = $product_info['sku'];
            ]]>
            </add>
        </operation>
    </file>


    <!--
    Featured
    - Adds heading title
    - Adds slick
    -->
    <file path="catalog/controller/extension/module/featured.php">
        <operation>
            <search index="0">
            <![CDATA[
$data['products'] = array();
            ]]>
            </search>
            <add position="before"><![CDATA[
$this->document->addScript('catalog/view/theme/cw/vendors/slick/slick.min.js', 'footer');

$data['heading_title'] = $setting['name'];
            ]]>
            </add>
        </operation>
    </file>


    <!--
    Breadcrumbs
    - Changes home link text
    -->
    <file path="catalog/language/ru-ru/ru-ru.php">
        <operation>
            <search index="0">
            <![CDATA[
$_['text_home']             = '<i class="fa fa-home"></i>';
            ]]>
            </search>
            <add position="replace"><![CDATA[
$_['text_home']             = 'Главная';
            ]]>
            </add>
        </operation>
    </file>

    <!--
    Remove sort orders
    -->
    <file path="system/library/cache/file.php">
        <operation>
            <search index="0">
            <![CDATA[
public function delete($key) {
            ]]>
            </search>
            <add position="replace" offset="10">
                <![CDATA[
public function delete($key) {
    $files = glob(DIR_CACHE . 'cache.' . basename($key) . '.*');

    if ($files) {
        foreach ($files as $file) {
            if (!@unlink($file)) {
                clearstatcache(false, $file);
            }
        }
    }
}
                ]]>
            </add>
        </operation>
    </file>
</modification>

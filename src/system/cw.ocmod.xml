<?xml version="1.0" encoding="utf-8"?>
<modification>
    <name>Casual Watches must-use modifications</name>
    <version>1.0.0</version>
    <code>cw-mu</code>

    <!--
    Remove sort orders
    -->
    <file path="catalog/controller/product/category.php">
        <operation>
            <search index="0">
            <![CDATA[
'href'  => $this->url->link('product/category', 'path=' . $this->request->get['path'] . '&sort=p.price&order=DESC' . $url)
            ]]>
            </search>
            <add position="replace" offset="26"><![CDATA[
'href'  => $this->url->link('product/category', 'path=' . $this->request->get['path'] . '&sort=p.price&order=DESC' . $url)
            ]]>
            </add>
        </operation>
    </file>


    <!--
    Replaces the default swiper links in the carousel module
    -->
    <file path="catalog/controller/extension/module/carousel.php">
        <operation>
            <search index="0">
            <![CDATA[
$this->document->addStyle('catalog/view/javascript/jquery/swiper/css/swiper.min.css');
            ]]>
            </search>
            <add position="replace" offset="3"><![CDATA[
$this->document->addStyle('catalog/view/theme/cw/vendors/swiper/css/swiper.min.css');
$this->document->addScript('catalog/view/theme/cw/vendors/swiper/js/swiper.min.js');
            ]]>
            </add>
        </operation>
    </file>


    <!--
    Discount in product teaser
    -->
    <file path="catalog/controller/product/category.php">
        <operation>
            <search>
                <![CDATA[
$special = false;
                ]]>
            </search>
            <add position="after" offset="1">
                <![CDATA[
if ((float)$result['special']) {
    $discount = '-' . round(100 - $this->tax->calculate($result['special'], $result['tax_class_id'], $this->config->get('config_tax')) / $this->tax->calculate($result['price'], $result['tax_class_id'], $this->config->get('config_tax')) * 100) . '%';
} else {
    $discount = false;
}
                ]]>
            </add>
        </operation>

        <operation>
            <search>
                <![CDATA[
'special'     => $special,
                ]]>
            </search>
            <add position="after" offset="1">
                <![CDATA[
'discount'     => $discount,
                ]]>
            </add>
        </operation>
    </file>
</modification>
